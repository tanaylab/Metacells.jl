
<!DOCTYPE html>

<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Compute Modules · Metacells.jl v0.1.0
</title>
<meta name="title" content="Compute Modules · Metacells.jl v0.1.0"/>
<meta property="og:title" content="Compute Modules · Metacells.jl v0.1.0"/>
<meta property="twitter:title" content="Compute Modules · Metacells.jl v0.1.0"/>
<meta name="description" content="Documentation for Metacells.jl v0.1.0."/>
<meta property="og:description" content="Documentation for Metacells.jl v0.1.0."/>
<meta property="twitter:description" content="Documentation for Metacells.jl v0.1.0."/>
<script data-outdated-warner src="assets/warner.js">
</script>
<link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/>
<link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/>
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/>
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/>
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/>
<link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/>
<script>documenterBaseURL="."
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="assets/documenter.js">
</script>
<script src="search_index.js">
</script>
<script src="siteinfo.js">
</script>
<script src="../versions.js">
</script>
<link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/>
<link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/>
<link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/>
<link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/>
<link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/>
<link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/>
<script src="assets/themeswap.js">
</script>
</head>
<body>
<div id="documenter">
<nav class="docs-sidebar">
<div class="docs-package-name">
<span class="docs-autofit">
<a href="index.html">Metacells.jl v0.1.0
</a>
</span>
</div>
<button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)
</button>
<ul class="docs-menu">
<li>
<a class="tocitem" href="index.html">Metacells
</a>
</li>
<li>
<a class="tocitem" href="gmara.html">Gmara
</a>
</li>
<li>
<a class="tocitem" href="contracts.html">Contracts
</a>
</li>
<li>
<a class="tocitem" href="analyze_cells.html">Analyze Cells
</a>
</li>
<li>
<a class="tocitem" href="analyze_metacells.html">Analyze Metacells
</a>
</li>
<li>
<a class="tocitem" href="compute_blocks.html">Compute Blocks
</a>
</li>
<li>
<a class="tocitem" href="analyze_blocks.html">Analyze Blocks
</a>
</li>
<li class="is-active">
<a class="tocitem" href="compute_modules.html">Compute Modules
</a>
<ul class="internal">
<li>
<a class="tocitem" href="#Index">
<span>Index
</span>
</a>
</li>
</ul>
</li>
<li>
<a class="tocitem" href="analyze_modules.html">Analyze Modules
</a>
</li>
<li>
<a class="tocitem" href="compute_approximation.html">Compute Approximation
</a>
</li>
<li>
<a class="tocitem" href="analyze_approximation.html">Analyze Approximation
</a>
</li>
<li>
<a class="tocitem" href="sharpen_metacells.html">Sharpen Metacells
</a>
</li>
<li>
<a class="tocitem" href="anndata_format.html">AnnData Format
</a>
</li>
<li>
<a class="tocitem" href="defaults.html">Defaults
</a>
</li>
</ul>
<div class="docs-version-selector field has-addons">
<div class="control">
<span class="docs-label button is-static is-size-7">Version
</span>
</div>
<div class="docs-selector control is-expanded">
<div class="select is-fullwidth is-size-7">
<select id="documenter-version-selector">
</select>
</div>
</div>
</div>
</nav>
<div class="docs-main">
<header class="docs-navbar">
<a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#">
</a>
<nav class="breadcrumb">
<ul class="is-hidden-mobile">
<li class="is-active">
<a href="compute_modules.html">Compute Modules
</a>
</li>
</ul>
<ul class="is-hidden-tablet">
<li class="is-active">
<a href="compute_modules.html">Compute Modules
</a>
</li>
</ul>
</nav>
<div class="docs-right">
<a class="docs-navbar-link" href="https://github.com/tanaylab/Metacells.jl/blob/main{path}?plain=1#L{line}" title="View the repository on GitHub">
<span class="docs-icon fa-brands">
</span>
<span class="docs-label is-hidden-touch">GitHub
</span>
</a>
<a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings">
</a>
<a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings">
</a>
</div>
</header>
<article class="content" id="documenter-page">
<h1 id="Compute-Modules">
<a class="docs-heading-anchor" href="#Compute-Modules">Compute Modules
</a>
<a id="Compute-Modules-1">
</a>
<a class="docs-heading-anchor-permalink" href="#Compute-Modules" title="Permalink">
</a>
</h1>
<article class="docstring">
<header>
<a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring">
</a>
<a class="docstring-binding" id="Metacells.ComputeModules" href="#Metacells.ComputeModules">
<code>Metacells.ComputeModules
</code>
</a> — 
<span class="docstring-category">Module
</span>
<span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring">
</span>
</header>
<section>
<div>
<p>Group &quot;very correlated&quot; genes modules in each local environment.
</p>
</div>
</section>
</article>
<article class="docstring">
<header>
<a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring">
</a>
<a class="docstring-binding" id="Metacells.ComputeModules.compute_blocks_modules!" href="#Metacells.ComputeModules.compute_blocks_modules!">
<code>Metacells.ComputeModules.compute_blocks_modules!
</code>
</a> — 
<span class="docstring-category">Function
</span>
<span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring">
</span>
</header>
<section>
<div>
<pre>
<code class="language-julia hljs">function compute_blocks_modules!(
    daf::DafWriter;
    min_module_downsampled_UMIs::Integer = ```8```,
    min_module_strong_cells::Integer = ```12```,
    min_merge_fragments_correlation::Real = ```0.5```,
    min_merge_modules_correlation::Real = ```0.8```,
    min_downsamples::Integer = ```750```,
    min_downsamples_quantile::AbstractFloat = ```0.05```,
    max_downsamples_quantile::AbstractFloat = ```0.5```,
    overwrite::Bool = ```false```,
)::Nothing
</code>
</pre>
<p>Group the genes into modules based on their correlation.
</p>
<p>For each block:
</p>
<ol>
<li>
<p>Compute the correlation of the expression of the genes across all metacells in the block&#39;s environment.
</p>
</li>
<li>
<p>Cluster the genes based on this correlation, using the 
<code>:complete
</code> distance measure.
</p>
</li>
<li>
<p>Bottom-up group genes into fragments and then into complete modules. Fragments have at least 
<code>min_merge_fragments_correlation
</code> between all their genes. At some point, the fragment will contain enough genes so there will be at least 
<code>min_module_strong_cells
</code>. A &quot;strong&quot; cell is expected to have at least 
<code>min_module_downsampled_UMIs
</code>, if we downsample the cells in the environment using 
<code>min_downsamples
</code>, 
<code>min_downsamples_quantile
</code>, and 
<code>max_downsamples_quantile
</code>. If the 
<code>divergence
</code> is specified per gene, then it is applied to the UMIs. When this happens, we mark the fragment (which might be a single gene!) as a valid module. We will only merge two such modules if the correlation between all their genes is at least 
<code>min_merge_modules_correlation
</code>.
</p>
</li>
<li>
<p>Having merged some of the genes into modules, we repeat steps 2 and 3 for the unmerged genes until no new modules are found.
</p>
</li>
<li>
<p>Most of the genes will not end up in a valid module, and are given the module index 0. The other genes are given a 1-based module index. We need to store a matrix of module indices instead of module names due to 
<code>Daf
</code> limitations (no matrices of strings).
</p>
</li>
</ol>
<div class="admonition is-info" id="Note-96e9ab9d5b588dd8">
<header class="admonition-header">Note
<a class="admonition-anchor" href="#Note-96e9ab9d5b588dd8" title="Permalink">
</a>
</header>
<div class="admonition-body">
<p>This uses the virtual 
<a href="contracts.html#Metacells.Contracts.metacell_gene_fraction_matrix">
<code>metacell_gene_fraction_matrix
</code>
</a>. You will need an 
<code>adapter
</code> to map these to concrete fractions (geomean, linear, scaled, ...). In addition, you might want to restrict the set of genes that are candidates to be included in the module, for example just to 
<code>is_covered
</code> genes.
</p>
</div>
</div>
<p>
<strong>Inputs
</strong>
</p>
<p>
<strong>Axes
</strong>
</p>
<p>
<strong>gene
</strong> (required): Sequenced genes.
</p>
<p>
<strong>cell
</strong> (required): Sequenced single cells.
</p>
<p>
<strong>metacell
</strong> (required): Minimal-sized groups of cells for robust point estimates.
</p>
<p>
<strong>block
</strong> (required): Distinct groups of metacells with &quot;very close&quot; estimated cell state.
</p>
<p>
<strong>Vectors
</strong>
</p>
<p>
<strong>cell @ metacell
</strong>::AbstractString (required): The unique metacell each cell belongs to.
</p>
<p>
<strong>metacell @ block
</strong>::AbstractString (required): The unique block each metacell belongs to.
</p>
<p>
<strong>gene @ divergence
</strong>::Union{Float32, Float64} (optional): Scale fold factors of each gene by multiplying with (1 - divergence) of the gene.
</p>
<p>
<strong>Matrices
</strong>
</p>
<p>
<strong>gene, cell @ UMIs
</strong>::Union{UInt16, UInt32, UInt64, UInt8} (required): The number of UMIs collected for each gene for each cell.
</p>
<p>
<strong>gene, metacell @ fraction
</strong>::Union{Float32, Float64} (required): Some estimated fraction of the UMIs of each gene in each metacell.
</p>
<p>
<strong>block, gene @ is
<em>environment
</em>marker
</strong>::Bool (required): A mask of genes that distinguish between cell states in each environment.
</p>
<p>
<strong>block, block @ is
<em>in
</em>environment
</strong>::Bool (required): For each block, the (column) mask of nearby blocks in its expanded environment.
</p>
<p>
<strong>Outputs
</strong>
</p>
<p>
<strong>Axes
</strong>
</p>
<p>
<strong>module
</strong> (guaranteed): A local (per block) gene module.
</p>
<p>
<strong>Matrices
</strong>
</p>
<p>
<strong>block, gene @ module_index
</strong>::Union{UInt16, UInt32, UInt64, UInt8} (guaranteed): The index of the gene module each gene belongs to in the environment of each block.
</p>
<p>
<strong>block, module @ is_found
</strong>::Bool (guaranteed): Whether each gene module is found in each block.
</p>
<p>
<strong>block, module @ min
<em>gene
</em>correlation
</strong>::Union{Float32, Float64} (guaranteed): The minimal correlation between the genes of each gene module of each block.
</p>
</div>
</section>
</article>
<h2 id="Index">
<a class="docs-heading-anchor" href="#Index">Index
</a>
<a id="Index-1">
</a>
<a class="docs-heading-anchor-permalink" href="#Index" title="Permalink">
</a>
</h2>
<ul>
</ul>
</article>
<nav class="docs-footer">
<a class="docs-footer-prevpage" href="analyze_blocks.html">« Analyze Blocks
</a>
<a class="docs-footer-nextpage" href="analyze_modules.html">Analyze Modules »
</a>
<div class="flexbox-break">
</div>
<p class="footer-message">Powered by 
<a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl
</a> and the 
<a href="https://julialang.org/">Julia Programming Language
</a>.
</p>
</nav>
</div>
<div class="modal" id="documenter-settings">
<div class="modal-background">
</div>
<div class="modal-card">
<header class="modal-card-head">
<p class="modal-card-title">Settings
</p>
<button class="delete">
</button>
</header>
<section class="modal-card-body">
<p>
<label class="label">Theme
</label>
<div class="select">
<select id="documenter-themepicker">
<option value="auto">Automatic (OS)
</option>
<option value="documenter-light">documenter-light
</option>
<option value="documenter-dark">documenter-dark
</option>
<option value="catppuccin-latte">catppuccin-latte
</option>
<option value="catppuccin-frappe">catppuccin-frappe
</option>
<option value="catppuccin-macchiato">catppuccin-macchiato
</option>
<option value="catppuccin-mocha">catppuccin-mocha
</option>
</select>
</div>
</p>
<hr/>
<p>This document was generated with 
<a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl
</a> version 1.12.0. Using Julia version 1.11.5.
</p>
</section>
<footer class="modal-card-foot">
</footer>
</div>
</div>
</div>
</body>
</html>
