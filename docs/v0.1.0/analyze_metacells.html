
<!DOCTYPE html>

<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Analyze Metacells · Metacells.jl v0.1.0
</title>
<meta name="title" content="Analyze Metacells · Metacells.jl v0.1.0"/>
<meta property="og:title" content="Analyze Metacells · Metacells.jl v0.1.0"/>
<meta property="twitter:title" content="Analyze Metacells · Metacells.jl v0.1.0"/>
<meta name="description" content="Documentation for Metacells.jl v0.1.0."/>
<meta property="og:description" content="Documentation for Metacells.jl v0.1.0."/>
<meta property="twitter:description" content="Documentation for Metacells.jl v0.1.0."/>
<script data-outdated-warner src="assets/warner.js">
</script>
<link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/>
<link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/>
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/>
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/>
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/>
<link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/>
<script>documenterBaseURL="."
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="assets/documenter.js">
</script>
<script src="search_index.js">
</script>
<script src="siteinfo.js">
</script>
<script src="../versions.js">
</script>
<link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/>
<link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/>
<link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/>
<link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/>
<link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/>
<link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/>
<script src="assets/themeswap.js">
</script>
</head>
<body>
<div id="documenter">
<nav class="docs-sidebar">
<div class="docs-package-name">
<span class="docs-autofit">
<a href="index.html">Metacells.jl v0.1.0
</a>
</span>
</div>
<button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)
</button>
<ul class="docs-menu">
<li>
<a class="tocitem" href="index.html">Metacells
</a>
</li>
<li>
<a class="tocitem" href="gmara.html">Gmara
</a>
</li>
<li>
<a class="tocitem" href="contracts.html">Contracts
</a>
</li>
<li>
<a class="tocitem" href="analyze_cells.html">Analyze Cells
</a>
</li>
<li class="is-active">
<a class="tocitem" href="analyze_metacells.html">Analyze Metacells
</a>
<ul class="internal">
<li>
<a class="tocitem" href="#Counts">
<span>Counts
</span>
</a>
</li>
<li>
<a class="tocitem" href="#UMIs">
<span>UMIs
</span>
</a>
</li>
<li>
<a class="tocitem" href="#Linear-Fractions">
<span>Linear Fractions
</span>
</a>
</li>
<li>
<a class="tocitem" href="#Covered-Fractions">
<span>Covered Fractions
</span>
</a>
</li>
<li>
<a class="tocitem" href="#Geomean-Fractions">
<span>Geomean Fractions
</span>
</a>
</li>
<li>
<a class="tocitem" href="#Types">
<span>Types
</span>
</a>
</li>
<li>
<a class="tocitem" href="#Distances">
<span>Distances
</span>
</a>
</li>
<li>
<a class="tocitem" href="#Index">
<span>Index
</span>
</a>
</li>
</ul>
</li>
<li>
<a class="tocitem" href="compute_blocks.html">Compute Blocks
</a>
</li>
<li>
<a class="tocitem" href="analyze_blocks.html">Analyze Blocks
</a>
</li>
<li>
<a class="tocitem" href="compute_modules.html">Compute Modules
</a>
</li>
<li>
<a class="tocitem" href="analyze_modules.html">Analyze Modules
</a>
</li>
<li>
<a class="tocitem" href="anndata_format.html">AnnData Format
</a>
</li>
<li>
<a class="tocitem" href="defaults.html">Defaults
</a>
</li>
</ul>
<div class="docs-version-selector field has-addons">
<div class="control">
<span class="docs-label button is-static is-size-7">Version
</span>
</div>
<div class="docs-selector control is-expanded">
<div class="select is-fullwidth is-size-7">
<select id="documenter-version-selector">
</select>
</div>
</div>
</div>
</nav>
<div class="docs-main">
<header class="docs-navbar">
<a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#">
</a>
<nav class="breadcrumb">
<ul class="is-hidden-mobile">
<li class="is-active">
<a href="analyze_metacells.html">Analyze Metacells
</a>
</li>
</ul>
<ul class="is-hidden-tablet">
<li class="is-active">
<a href="analyze_metacells.html">Analyze Metacells
</a>
</li>
</ul>
</nav>
<div class="docs-right">
<a class="docs-navbar-link" href="https://github.com/tanaylab/Metacells.jl/blob/main{path}?plain=1#L{line}" title="View the repository on GitHub">
<span class="docs-icon fa-brands">
</span>
<span class="docs-label is-hidden-touch">GitHub
</span>
</a>
<a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings">
</a>
<a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings">
</a>
</div>
</header>
<article class="content" id="documenter-page">
<h1 id="Analyze-Metacells">
<a class="docs-heading-anchor" href="#Analyze-Metacells">Analyze Metacells
</a>
<a id="Analyze-Metacells-1">
</a>
<a class="docs-heading-anchor-permalink" href="#Analyze-Metacells" title="Permalink">
</a>
</h1>
<article class="docstring">
<header>
<a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring">
</a>
<a class="docstring-binding" id="Metacells.AnalyzeMetacells" href="#Metacells.AnalyzeMetacells">
<code>Metacells.AnalyzeMetacells
</code>
</a> — 
<span class="docstring-category">Module
</span>
<span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring">
</span>
</header>
<section>
<div>
<p>Do simple metacells analysis.
</p>
</div>
</section>
</article>
<h2 id="Counts">
<a class="docs-heading-anchor" href="#Counts">Counts
</a>
<a id="Counts-1">
</a>
<a class="docs-heading-anchor-permalink" href="#Counts" title="Permalink">
</a>
</h2>
<article class="docstring">
<header>
<a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring">
</a>
<a class="docstring-binding" id="Metacells.AnalyzeMetacells.compute_metacells_n_cells!" href="#Metacells.AnalyzeMetacells.compute_metacells_n_cells!">
<code>Metacells.AnalyzeMetacells.compute_metacells_n_cells!
</code>
</a> — 
<span class="docstring-category">Function
</span>
<span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring">
</span>
</header>
<section>
<div>
<pre>
<code class="language-julia hljs">function compute_metacells_n_metacells!(
    daf::DafWriter;
    overwrite::Bool = ```false```,
)::Nothing
</code>
</pre>
<p>The total number of metacells per metacell.
</p>
<p>
<strong>Inputs
</strong>
</p>
<p>
<strong>Axes
</strong>
</p>
<p>
<strong>metacell
</strong> (required): Minimal-sized groups of cells for robust point estimates.
</p>
<p>
<strong>cell
</strong> (required): Sequenced single cells.
</p>
<p>
<strong>Vectors
</strong>
</p>
<p>
<strong>cell @ metacell
</strong>::AbstractString (required): The unique metacell each cell belongs to.
</p>
<p>
<strong>Outputs
</strong>
</p>
<p>
<strong>Vectors
</strong>
</p>
<p>
<strong>metacell @ n_cells
</strong>::Union{UInt16, UInt32, UInt64, UInt8} (guaranteed): The number of cells in each metacell.
</p>
</div>
</section>
</article>
<h2 id="UMIs">
<a class="docs-heading-anchor" href="#UMIs">UMIs
</a>
<a id="UMIs-1">
</a>
<a class="docs-heading-anchor-permalink" href="#UMIs" title="Permalink">
</a>
</h2>
<article class="docstring">
<header>
<a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring">
</a>
<a class="docstring-binding" id="Metacells.AnalyzeMetacells.compute_metacells_genes_UMIs!" href="#Metacells.AnalyzeMetacells.compute_metacells_genes_UMIs!">
<code>Metacells.AnalyzeMetacells.compute_metacells_genes_UMIs!
</code>
</a> — 
<span class="docstring-category">Function
</span>
<span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring">
</span>
</header>
<section>
<div>
<pre>
<code class="language-julia hljs">function compute_metacells_genes_UMIs!(
    daf::DafWriter;
    overwrite::Bool = ```false```,
)::Nothing
</code>
</pre>
<p>The total number of UMIs used to estimate the fraction of each gene in each metacell.
</p>
<p>
<strong>Inputs
</strong>
</p>
<p>
<strong>Axes
</strong>
</p>
<p>
<strong>cell
</strong> (required): Sequenced single cells.
</p>
<p>
<strong>gene
</strong> (required): Sequenced genes.
</p>
<p>
<strong>metacell
</strong> (required): Minimal-sized groups of cells for robust point estimates.
</p>
<p>
<strong>Vectors
</strong>
</p>
<p>
<strong>cell @ metacell
</strong>::AbstractString (required): The unique metacell each cell belongs to.
</p>
<p>
<strong>Matrices
</strong>
</p>
<p>
<strong>gene, cell @ UMIs
</strong>::Union{UInt16, UInt32, UInt64, UInt8} (required): The number of UMIs collected for each gene for each cell.
</p>
<p>
<strong>Outputs
</strong>
</p>
<p>
<strong>Matrices
</strong>
</p>
<p>
<strong>gene, metacell @ UMIs
</strong>::Union{UInt16, UInt32, UInt64, UInt8} (guaranteed): The total number of UMIs of each gene in the cells of each metacell.
</p>
</div>
</section>
</article>
<article class="docstring">
<header>
<a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring">
</a>
<a class="docstring-binding" id="Metacells.AnalyzeMetacells.compute_metacells_total_UMIs!" href="#Metacells.AnalyzeMetacells.compute_metacells_total_UMIs!">
<code>Metacells.AnalyzeMetacells.compute_metacells_total_UMIs!
</code>
</a> — 
<span class="docstring-category">Function
</span>
<span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring">
</span>
</header>
<section>
<div>
<pre>
<code class="language-julia hljs">function compute_metacells_total_UMIs!(
    daf::DafWriter;
    overwrite::Bool = ```false```,
)::Nothing
</code>
</pre>
<p>The total number of UMIs used to estimate the fraction of all the genes in each metacell.
</p>
<p>
<strong>Inputs
</strong>
</p>
<p>
<strong>Axes
</strong>
</p>
<p>
<strong>gene
</strong> (required): Sequenced genes.
</p>
<p>
<strong>metacell
</strong> (required): Minimal-sized groups of cells for robust point estimates.
</p>
<p>
<strong>Vectors
</strong>
</p>
<p>
<strong>gene @ is_excluded
</strong>::Bool (required): A mask of genes that are excluded from consideration.
</p>
<p>
<strong>Matrices
</strong>
</p>
<p>
<strong>gene, metacell @ UMIs
</strong>::Union{UInt16, UInt32, UInt64, UInt8} (required): The total number of UMIs of each gene in the cells of each metacell.
</p>
<p>
<strong>Outputs
</strong>
</p>
<p>
<strong>Vectors
</strong>
</p>
<p>
<strong>metacell @ total_UMIs
</strong>::Union{UInt16, UInt32, UInt64, UInt8} (guaranteed): The total number of UMIs of all the non-excluded genes in each metacell.
</p>
</div>
</section>
</article>
<article class="docstring">
<header>
<a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring">
</a>
<a class="docstring-binding" id="Metacells.AnalyzeMetacells.compute_metacells_covered_UMIs!" href="#Metacells.AnalyzeMetacells.compute_metacells_covered_UMIs!">
<code>Metacells.AnalyzeMetacells.compute_metacells_covered_UMIs!
</code>
</a> — 
<span class="docstring-category">Function
</span>
<span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring">
</span>
</header>
<section>
<div>
<pre>
<code class="language-julia hljs">function compute_metacells_covered_UMIs!(
    daf::DafWriter;
    overwrite::Bool = ```false```,
)::Nothing
</code>
</pre>
<p>The total UMIs of covered genes per metacell.
</p>
<p>
<strong>Inputs
</strong>
</p>
<p>
<strong>Axes
</strong>
</p>
<p>
<strong>gene
</strong> (required): Sequenced genes.
</p>
<p>
<strong>metacell
</strong> (required): Minimal-sized groups of cells for robust point estimates.
</p>
<p>
<strong>Vectors
</strong>
</p>
<p>
<strong>gene @ is_covered
</strong>::Bool (required): A mask of genes that are covered by the model(s).
</p>
<p>
<strong>Matrices
</strong>
</p>
<p>
<strong>gene, metacell @ UMIs
</strong>::Union{UInt16, UInt32, UInt64, UInt8} (required): The total number of UMIs of each gene in the cells of each metacell.
</p>
<p>
<strong>Outputs
</strong>
</p>
<p>
<strong>Vectors
</strong>
</p>
<p>
<strong>metacell @ covered_UMIs
</strong>::Union{UInt16, UInt32, UInt64, UInt8} (guaranteed): The total number of the covered genes in each metacell.
</p>
</div>
</section>
</article>
<h2 id="Linear-Fractions">
<a class="docs-heading-anchor" href="#Linear-Fractions">Linear Fractions
</a>
<a id="Linear-Fractions-1">
</a>
<a class="docs-heading-anchor-permalink" href="#Linear-Fractions" title="Permalink">
</a>
</h2>
<article class="docstring">
<header>
<a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring">
</a>
<a class="docstring-binding" id="Metacells.AnalyzeMetacells.compute_metacells_genes_linear_fractions!" href="#Metacells.AnalyzeMetacells.compute_metacells_genes_linear_fractions!">
<code>Metacells.AnalyzeMetacells.compute_metacells_genes_linear_fractions!
</code>
</a> — 
<span class="docstring-category">Function
</span>
<span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring">
</span>
</header>
<section>
<div>
<pre>
<code class="language-julia hljs">function compute_metacells_genes_linear_fractions!(
    daf::DafWriter;
    overwrite::Bool = ```false```,
)::Nothing
</code>
</pre>
<p>An estimated linear fraction of the UMIs of each gene in each metacell. This is just the total UMIs of the gene in the metacell divided by the total UMIs of the metacell, which is the &quot;best&quot; estimate assuming multinomial sampling noise. However, this is sensitive to a few cells with very high expression levels (&quot;bursty&quot; genes).
</p>
<p>
<strong>Inputs
</strong>
</p>
<p>
<strong>Axes
</strong>
</p>
<p>
<strong>gene
</strong> (required): Sequenced genes.
</p>
<p>
<strong>metacell
</strong> (required): Minimal-sized groups of cells for robust point estimates.
</p>
<p>
<strong>Vectors
</strong>
</p>
<p>
<strong>gene @ is_excluded
</strong>::Bool (required): A mask of genes that are excluded from consideration.
</p>
<p>
<strong>Matrices
</strong>
</p>
<p>
<strong>gene, metacell @ UMIs
</strong>::Union{UInt16, UInt32, UInt64, UInt8} (required): The total number of UMIs of each gene in the cells of each metacell.
</p>
<p>
<strong>Outputs
</strong>
</p>
<p>
<strong>Matrices
</strong>
</p>
<p>
<strong>gene, metacell @ linear_fraction
</strong>::Union{Float32, Float64} (guaranteed): The linear fraction of the UMIs of each non-excluded gene in each metacell, out of the total UMIs.
</p>
</div>
</section>
</article>
<article class="docstring">
<header>
<a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring">
</a>
<a class="docstring-binding" id="Metacells.AnalyzeMetacells.compute_metacells_genes_log_linear_fractions!" href="#Metacells.AnalyzeMetacells.compute_metacells_genes_log_linear_fractions!">
<code>Metacells.AnalyzeMetacells.compute_metacells_genes_log_linear_fractions!
</code>
</a> — 
<span class="docstring-category">Function
</span>
<span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring">
</span>
</header>
<section>
<div>
<pre>
<code class="language-julia hljs">function compute_metacells_genes_log_linear_fractions!(
    daf::DafWriter;
    gene_fraction_regularization::AbstractFloat = ```1.0e-5```,
    overwrite::Bool = ```false```,
)::Nothing
</code>
</pre>
<p>The log base 2 of the estimated linear fraction of the UMIs of each gene in each metacell. This adds the 
<code>gene_fraction_regularization
</code> to deal with zero fractions.
</p>
<p>
<strong>Inputs
</strong>
</p>
<p>
<strong>Axes
</strong>
</p>
<p>
<strong>gene
</strong> (required): Sequenced genes.
</p>
<p>
<strong>metacell
</strong> (required): Minimal-sized groups of cells for robust point estimates.
</p>
<p>
<strong>Matrices
</strong>
</p>
<p>
<strong>gene, metacell @ linear_fraction
</strong>::Union{Float32, Float64} (required): The linear fraction of the UMIs of each non-excluded gene in each metacell, out of the total UMIs.
</p>
<p>
<strong>Outputs
</strong>
</p>
<p>
<strong>Matrices
</strong>
</p>
<p>
<strong>gene, metacell @ log
<em>linear
</em>fraction
</strong>::Union{Float32, Float64} (guaranteed): The log base 2 of the linear fraction of the UMIs of each non-excluded gene in each metacell, out of the total UMIs.
</p>
</div>
</section>
</article>
<h2 id="Covered-Fractions">
<a class="docs-heading-anchor" href="#Covered-Fractions">Covered Fractions
</a>
<a id="Covered-Fractions-1">
</a>
<a class="docs-heading-anchor-permalink" href="#Covered-Fractions" title="Permalink">
</a>
</h2>
<article class="docstring">
<header>
<a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring">
</a>
<a class="docstring-binding" id="Metacells.AnalyzeMetacells.compute_metacells_genes_covered_fractions!" href="#Metacells.AnalyzeMetacells.compute_metacells_genes_covered_fractions!">
<code>Metacells.AnalyzeMetacells.compute_metacells_genes_covered_fractions!
</code>
</a> — 
<span class="docstring-category">Function
</span>
<span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring">
</span>
</header>
<section>
<div>
<pre>
<code class="language-julia hljs">function compute_metacells_genes_covered_fractions!(
    daf::DafWriter;
    overwrite::Bool = ```false```,
)::Nothing
</code>
</pre>
<p>An estimated linear fraction of the UMIs of each covered gene in each metacell. By considering only the covered genes this avoid the impact of highly-expressed lateral genes (e.g., cell cycle). Otherwise is similar to 
<a href="analyze_metacells.html#Metacells.AnalyzeMetacells.compute_metacells_genes_linear_fractions!">
<code>compute_metacells_genes_linear_fractions!
</code>
</a>.
</p>
<p>
<strong>Inputs
</strong>
</p>
<p>
<strong>Axes
</strong>
</p>
<p>
<strong>gene
</strong> (required): Sequenced genes.
</p>
<p>
<strong>metacell
</strong> (required): Minimal-sized groups of cells for robust point estimates.
</p>
<p>
<strong>Vectors
</strong>
</p>
<p>
<strong>gene @ is_covered
</strong>::Bool (required): A mask of genes that are covered by the model(s).
</p>
<p>
<strong>Matrices
</strong>
</p>
<p>
<strong>gene, metacell @ UMIs
</strong>::Union{UInt16, UInt32, UInt64, UInt8} (required): The total number of UMIs of each gene in the cells of each metacell.
</p>
<p>
<strong>Outputs
</strong>
</p>
<p>
<strong>Matrices
</strong>
</p>
<p>
<strong>gene, metacell @ covered_fraction
</strong>::Union{Float32, Float64} (guaranteed): The linear fraction of the UMIs of each covered gene in each metacell, out of the total covered UMIs.
</p>
</div>
</section>
</article>
<article class="docstring">
<header>
<a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring">
</a>
<a class="docstring-binding" id="Metacells.AnalyzeMetacells.compute_metacells_genes_log_covered_fractions!" href="#Metacells.AnalyzeMetacells.compute_metacells_genes_log_covered_fractions!">
<code>Metacells.AnalyzeMetacells.compute_metacells_genes_log_covered_fractions!
</code>
</a> — 
<span class="docstring-category">Function
</span>
<span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring">
</span>
</header>
<section>
<div>
<pre>
<code class="language-julia hljs">function compute_metacells_genes_log_covered_fractions!(
    daf::DafWriter;
    gene_fraction_regularization::AbstractFloat = ```1.0e-5```,
    overwrite::Bool = ```false```,
)::Nothing
</code>
</pre>
<p>The log base 2 of the estimated linear fraction of the UMIs of each covered gene in each metacell. This adds the 
<code>gene_fraction_regularization
</code> to deal with zero fractions.
</p>
<p>
<strong>Inputs
</strong>
</p>
<p>
<strong>Axes
</strong>
</p>
<p>
<strong>gene
</strong> (required): Sequenced genes.
</p>
<p>
<strong>metacell
</strong> (required): Minimal-sized groups of cells for robust point estimates.
</p>
<p>
<strong>Matrices
</strong>
</p>
<p>
<strong>gene, metacell @ covered_fraction
</strong>::Union{Float32, Float64} (required): The linear fraction of the UMIs of each covered gene in each metacell, out of the total covered UMIs.
</p>
<p>
<strong>Outputs
</strong>
</p>
<p>
<strong>Matrices
</strong>
</p>
<p>
<strong>metacell, gene @ log
<em>covered
</em>fraction
</strong>::Union{Float32, Float64} (guaranteed): The log base 2 of the linear fraction of the UMIs of each covered gene in each metacell, out of the total covered UMIs.
</p>
</div>
</section>
</article>
<h2 id="Geomean-Fractions">
<a class="docs-heading-anchor" href="#Geomean-Fractions">Geomean Fractions
</a>
<a id="Geomean-Fractions-1">
</a>
<a class="docs-heading-anchor-permalink" href="#Geomean-Fractions" title="Permalink">
</a>
</h2>
<article class="docstring">
<header>
<a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring">
</a>
<a class="docstring-binding" id="Metacells.AnalyzeMetacells.compute_metacells_genes_geomean_fractions!" href="#Metacells.AnalyzeMetacells.compute_metacells_genes_geomean_fractions!">
<code>Metacells.AnalyzeMetacells.compute_metacells_genes_geomean_fractions!
</code>
</a> — 
<span class="docstring-category">Function
</span>
<span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring">
</span>
</header>
<section>
<div>
<pre>
<code class="language-julia hljs">compute_metacells_genes_geomean_fractions!(
    daf::DafWriter;
    UMIs_regularization::AbstractFloat = ```0.0625```,
    min_downsamples::Integer = ```750```,
    min_downsamples_quantile::AbstractFloat = ```0.05```,
    max_downsamples_quantile::AbstractFloat = ```0.5```,
    rng::AbstractRNG = default_rng(),
    overwrite::Bool = ```false```,
)::Nothing
</code>
</pre>
<p>Given an assignment of cells to metacell, compute an geomean estimation of the fraction of UMIs of each gene for each metacell.
</p>
<p>The linear way to do this would be to just take the total UMIs of the gene out of the total UMIs of the metacell. However, this method has a weakness; a single strong cell with a &quot;very different&quot; fraction of the gene will dominate (that is, the method is sensitive to outliers).
</p>
<p>Instead, we take the geometric mean of the fractions of the gene in the cells. This however raises a few issues we need to deal with:
</p>
<ul>
<li>
<p>Genes with zero UMIs are a problem; to combat this, we add a 
<code>UMIs_regularization
</code> factor when computing the fractions, take the geomean, and subtract the regularization at the end (so all-zero genes will still get a zero overall fraction).
</p>
</li>
<li>
<p>We want to give more weight to cells with more UMIs, so we use a scaled geomean. The weight we give to each cell is the log of the total number of UMIs in it.
</p>
</li>
<li>
<p>The geomean fractions of all the genes in a metacell do not sum to one, so we scale them. This has the unfortunate side effect that the end result does not obey a nice relation to the linear fraction of the gene in each of the cells; in particular, the final result might be higher than all of these per-cell fractions (ouch).
</p>
</li>
</ul>
<p>This raises an important point about the whole &quot;fraction of UMIs of a gene in a cell&quot; concept, which is that it is highly dependent on the set of genes you pick to compute the fraction out of (that is, the denominator). This places restrictions on how you should use these fractions:
</p>
<ul>
<li>
<p>You can&#39;t just compare these fractions between two arbitrary data sets, as the denominators aren&#39;t the same. You must identify the set of common genes, and renormalize the fractions to sum to one in this subset, in both data sets. Only then can you meaningfully compare the results.
</p>
</li>
<li>
<p>Even if you compare two data sets with the same set of genes (or even two subsets of the same data set, such as two &quot;cell types&quot;), if a specific &quot;gene program&quot; has a very high total expression in only one of them, then all other genes will artificially appear to be lower.
</p>
<p>This is why we recommend excluding ribosomal genes from the data sets; they can take up anything between almost none to over two thirds of the total UMIs, and this varies between &quot;cell types&quot;. This means that if they are included in the denominator, the fractions of otherwise &quot;identical&quot; genes will appear to differ by a factor of up to 3X
</p>
<p>Luckily, most gene programs we deal with have a total expression of a few percent at most, so this effect is negligible. However if you identify a gene program with a total expression higher than, say, 10%, you should consider its effect on the rest of the genes.
</p>
</li>
</ul>
<p>
<strong>Inputs
</strong>
</p>
<p>
<strong>Axes
</strong>
</p>
<p>
<strong>cell
</strong> (required): Sequenced single cells.
</p>
<p>
<strong>gene
</strong> (required): Sequenced genes.
</p>
<p>
<strong>metacell
</strong> (required): Minimal-sized groups of cells for robust point estimates.
</p>
<p>
<strong>Vectors
</strong>
</p>
<p>
<strong>gene @ is_excluded
</strong>::Bool (required): A mask of genes that are excluded from consideration.
</p>
<p>
<strong>cell @ total_UMIs
</strong>::Union{UInt16, UInt32, UInt64, UInt8} (required): The total number of UMIs of all the non-excluded genes in each cell.
</p>
<p>
<strong>cell @ metacell
</strong>::AbstractString (required): The unique metacell each cell belongs to.
</p>
<p>
<strong>Matrices
</strong>
</p>
<p>
<strong>gene, cell @ UMIs
</strong>::Union{UInt16, UInt32, UInt64, UInt8} (required): The number of UMIs collected for each gene for each cell.
</p>
<p>
<strong>Outputs
</strong>
</p>
<p>
<strong>Matrices
</strong>
</p>
<p>
<strong>gene, metacell @ geomean_fraction
</strong>::Union{Float32, Float64} (guaranteed): The geomean fraction of the UMIs of each gene in each metacell.
</p>
</div>
</section>
</article>
<article class="docstring">
<header>
<a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring">
</a>
<a class="docstring-binding" id="Metacells.AnalyzeMetacells.compute_metacells_genes_log_geomean_fractions!" href="#Metacells.AnalyzeMetacells.compute_metacells_genes_log_geomean_fractions!">
<code>Metacells.AnalyzeMetacells.compute_metacells_genes_log_geomean_fractions!
</code>
</a> — 
<span class="docstring-category">Function
</span>
<span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring">
</span>
</header>
<section>
<div>
<pre>
<code class="language-julia hljs">function compute_metacells_genes_log_geomean_fractions!(
    daf::DafWriter;
    gene_fraction_regularization::AbstractFloat = ```1.0e-5```,
    overwrite::Bool = ```false```,
)::Nothing
</code>
</pre>
<p>The log base 2 of the estimated geomean fraction of the UMIs of each gene in each metacell. This adds the 
<code>gene_fraction_regularization
</code> to deal with zero fractions.
</p>
<p>
<strong>Inputs
</strong>
</p>
<p>
<strong>Axes
</strong>
</p>
<p>
<strong>gene
</strong> (required): Sequenced genes.
</p>
<p>
<strong>metacell
</strong> (required): Minimal-sized groups of cells for robust point estimates.
</p>
<p>
<strong>Matrices
</strong>
</p>
<p>
<strong>gene, metacell @ geomean_fraction
</strong>::Union{Float32, Float64} (required): The geomean fraction of the UMIs of each gene in each metacell.
</p>
<p>
<strong>Outputs
</strong>
</p>
<p>
<strong>Matrices
</strong>
</p>
<p>
<strong>gene, metacell @ log
<em>geomean
</em>fraction
</strong>::Union{Float32, Float64} (guaranteed): The log base 2 of the geomean fraction of the UMIs of each gene in each metacell.
</p>
</div>
</section>
</article>
<h2 id="Types">
<a class="docs-heading-anchor" href="#Types">Types
</a>
<a id="Types-1">
</a>
<a class="docs-heading-anchor-permalink" href="#Types" title="Permalink">
</a>
</h2>
<article class="docstring">
<header>
<a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring">
</a>
<a class="docstring-binding" id="Metacells.AnalyzeMetacells.compute_cells_types_by_metacells!" href="#Metacells.AnalyzeMetacells.compute_cells_types_by_metacells!">
<code>Metacells.AnalyzeMetacells.compute_cells_types_by_metacells!
</code>
</a> — 
<span class="docstring-category">Function
</span>
<span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring">
</span>
</header>
<section>
<div>
<pre>
<code class="language-julia hljs">function compute_cells_types_by_metacells!(
    daf::DafWriter;
    overwrite::Bool = ```false```,
)::Nothing
</code>
</pre>
<p>The type of each cell, based on the type of the metacell it belongs to.
</p>
<p>
<strong>Inputs
</strong>
</p>
<p>
<strong>Axes
</strong>
</p>
<p>
<strong>metacell
</strong> (required): Minimal-sized groups of cells for robust point estimates.
</p>
<p>
<strong>cell
</strong> (required): Sequenced single cells.
</p>
<p>
<strong>Vectors
</strong>
</p>
<p>
<strong>cell @ metacell
</strong>::AbstractString (required): The unique metacell each cell belongs to.
</p>
<p>
<strong>metacell @ type
</strong>::AbstractString (required): The type each metacell belongs to.
</p>
<p>
<strong>Outputs
</strong>
</p>
<p>
<strong>Vectors
</strong>
</p>
<p>
<strong>cell @ type
</strong>::AbstractString (guaranteed): The type each cell belongs to.
</p>
</div>
</section>
</article>
<article class="docstring">
<header>
<a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring">
</a>
<a class="docstring-binding" id="Metacells.AnalyzeMetacells.compute_metacells_types_by_cells!" href="#Metacells.AnalyzeMetacells.compute_metacells_types_by_cells!">
<code>Metacells.AnalyzeMetacells.compute_metacells_types_by_cells!
</code>
</a> — 
<span class="docstring-category">Function
</span>
<span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring">
</span>
</header>
<section>
<div>
<pre>
<code class="language-julia hljs">function compute_metacells_types_by_cells!(
    daf::DafWriter;
    overwrite::Bool = ```false```,
)::Nothing
</code>
</pre>
<p>The type of each metacell, based on is cell types. This assumes that each cell was assigned type, either because we imported the data from a cell-based atlas, or from previous computed metacells.
</p>
<p>
<strong>Inputs
</strong>
</p>
<p>
<strong>Axes
</strong>
</p>
<p>
<strong>metacell
</strong> (required): Minimal-sized groups of cells for robust point estimates.
</p>
<p>
<strong>cell
</strong> (required): Sequenced single cells.
</p>
<p>
<strong>Vectors
</strong>
</p>
<p>
<strong>cell @ metacell
</strong>::AbstractString (required): The unique metacell each cell belongs to.
</p>
<p>
<strong>cell @ type
</strong>::AbstractString (required): The type each cell belongs to.
</p>
<p>
<strong>Outputs
</strong>
</p>
<p>
<strong>Vectors
</strong>
</p>
<p>
<strong>metacell @ type
</strong>::AbstractString (guaranteed): The type each metacell belongs to.
</p>
</div>
</section>
</article>
<h2 id="Distances">
<a class="docs-heading-anchor" href="#Distances">Distances
</a>
<a id="Distances-1">
</a>
<a class="docs-heading-anchor-permalink" href="#Distances" title="Permalink">
</a>
</h2>
<article class="docstring">
<header>
<a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring">
</a>
<a class="docstring-binding" id="Metacells.AnalyzeMetacells.compute_metacells_euclidean_distances!" href="#Metacells.AnalyzeMetacells.compute_metacells_euclidean_distances!">
<code>Metacells.AnalyzeMetacells.compute_metacells_euclidean_distances!
</code>
</a> — 
<span class="docstring-category">Function
</span>
<span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring">
</span>
</header>
<section>
<div>
<pre>
<code class="language-julia hljs">function compute_metacells_euclidean_distances!(
    daf::DafWriter;
    overwrite::Bool = ```false```,
)::Nothing
</code>
</pre>
<p>The Euclidean distance between the log of the covered fraction of the skeleton genes between the metacells.
</p>
<p>
<strong>Inputs
</strong>
</p>
<p>
<strong>Axes
</strong>
</p>
<p>
<strong>metacell
</strong> (required): Minimal-sized groups of cells for robust point estimates.
</p>
<p>
<strong>gene
</strong> (required): Sequenced genes.
</p>
<p>
<strong>Vectors
</strong>
</p>
<p>
<strong>gene @ is_skeleton
</strong>::Bool (required): A mask of genes that are used to predict the values of the rest of the (covered) genes.
</p>
<p>
<strong>Matrices
</strong>
</p>
<p>
<strong>metacell, gene @ log
<em>covered
</em>fraction
</strong>::Union{Float32, Float64} (required): The log base 2 of the linear fraction of the UMIs of each covered gene in each metacell, out of the total covered UMIs.
</p>
<p>
<strong>Outputs
</strong>
</p>
<p>
<strong>Matrices
</strong>
</p>
<p>
<strong>metacell, metacell @ euclidean
<em>skeleton
</em>distance
</strong>::Union{Float32, Float64} (guaranteed): The Euclidean distance between the log of the covered fraction of the skeleton genes between the metacells.
</p>
</div>
</section>
</article>
<article class="docstring">
<header>
<a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring">
</a>
<a class="docstring-binding" id="Metacells.AnalyzeMetacells.compute_metacells_max_skeleton_fold_distances!" href="#Metacells.AnalyzeMetacells.compute_metacells_max_skeleton_fold_distances!">
<code>Metacells.AnalyzeMetacells.compute_metacells_max_skeleton_fold_distances!
</code>
</a> — 
<span class="docstring-category">Function
</span>
<span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring">
</span>
</header>
<section>
<div>
<pre>
<code class="language-julia hljs">function compute_metacells_max_skeleton_fold_distances!(
    daf::DafWriter;
    gene_fraction_regularization::AbstractFloat = ```1.0e-5```,
    min_significant_gene_UMIs::Integer = ```40```,
    fold_confidence::AbstractFloat = ```0.9```,
    overwrite::Bool = ```false```,
)::Nothing
</code>
</pre>
<p>The maximal significant fold factor between the covered fraction of skeleton genes between the metacells. This uses heuristics to require the fold factor be based on a sufficient number of UMIs to be robust.
</p>
<p>The fold factor is log (base 2) of the gene expression using the 
<code>gene_fraction_regularization
</code>. For computing this fold factor, we ignore &quot;insignificant&quot; genes whose total UMIs in the compared metacells isn&#39;t at least 
<code>min_significant_gene_UMIs
</code>. We also we reduce the distance using the 
<code>fold_confidence
</code> based on the number of UMIs used to estimate the expression in the metacells.
</p>
<p>
<strong>Inputs
</strong>
</p>
<p>
<strong>Axes
</strong>
</p>
<p>
<strong>metacell
</strong> (required): Minimal-sized groups of cells for robust point estimates.
</p>
<p>
<strong>gene
</strong> (required): Sequenced genes.
</p>
<p>
<strong>Vectors
</strong>
</p>
<p>
<strong>gene @ is_skeleton
</strong>::Bool (required): A mask of genes that are used to predict the values of the rest of the (covered) genes.
</p>
<p>
<strong>metacell @ covered_UMIs
</strong>::Union{UInt16, UInt32, UInt64, UInt8} (required): The total number of the covered genes in each metacell.
</p>
<p>
<strong>Matrices
</strong>
</p>
<p>
<strong>gene, metacell @ covered_fraction
</strong>::Union{Float32, Float64} (required): The linear fraction of the UMIs of each covered gene in each metacell, out of the total covered UMIs.
</p>
<p>
<strong>gene, metacell @ UMIs
</strong>::Union{UInt16, UInt32, UInt64, UInt8} (required): The total number of UMIs of each gene in the cells of each metacell.
</p>
<p>
<strong>Outputs
</strong>
</p>
<p>
<strong>Matrices
</strong>
</p>
<p>
<strong>metacell, metacell @ max
<em>skeleton
</em>fold_distance
</strong>::Union{Float32, Float64} (guaranteed): The maximal significant fold factor between the covered fraction of skeleton genes between the metacells.
</p>
</div>
</section>
</article>
<h2 id="Index">
<a class="docs-heading-anchor" href="#Index">Index
</a>
<a id="Index-1">
</a>
<a class="docs-heading-anchor-permalink" href="#Index" title="Permalink">
</a>
</h2>
<ul>
<li>
<a href="analyze_metacells.html#Metacells.AnalyzeMetacells">
<code>Metacells.AnalyzeMetacells
</code>
</a>
</li>
<li>
<a href="analyze_metacells.html#Metacells.AnalyzeMetacells.compute_cells_types_by_metacells!">
<code>Metacells.AnalyzeMetacells.compute_cells_types_by_metacells!
</code>
</a>
</li>
<li>
<a href="analyze_metacells.html#Metacells.AnalyzeMetacells.compute_metacells_covered_UMIs!">
<code>Metacells.AnalyzeMetacells.compute_metacells_covered_UMIs!
</code>
</a>
</li>
<li>
<a href="analyze_metacells.html#Metacells.AnalyzeMetacells.compute_metacells_euclidean_distances!">
<code>Metacells.AnalyzeMetacells.compute_metacells_euclidean_distances!
</code>
</a>
</li>
<li>
<a href="analyze_metacells.html#Metacells.AnalyzeMetacells.compute_metacells_genes_UMIs!">
<code>Metacells.AnalyzeMetacells.compute_metacells_genes_UMIs!
</code>
</a>
</li>
<li>
<a href="analyze_metacells.html#Metacells.AnalyzeMetacells.compute_metacells_genes_covered_fractions!">
<code>Metacells.AnalyzeMetacells.compute_metacells_genes_covered_fractions!
</code>
</a>
</li>
<li>
<a href="analyze_metacells.html#Metacells.AnalyzeMetacells.compute_metacells_genes_geomean_fractions!">
<code>Metacells.AnalyzeMetacells.compute_metacells_genes_geomean_fractions!
</code>
</a>
</li>
<li>
<a href="analyze_metacells.html#Metacells.AnalyzeMetacells.compute_metacells_genes_linear_fractions!">
<code>Metacells.AnalyzeMetacells.compute_metacells_genes_linear_fractions!
</code>
</a>
</li>
<li>
<a href="analyze_metacells.html#Metacells.AnalyzeMetacells.compute_metacells_genes_log_covered_fractions!">
<code>Metacells.AnalyzeMetacells.compute_metacells_genes_log_covered_fractions!
</code>
</a>
</li>
<li>
<a href="analyze_metacells.html#Metacells.AnalyzeMetacells.compute_metacells_genes_log_geomean_fractions!">
<code>Metacells.AnalyzeMetacells.compute_metacells_genes_log_geomean_fractions!
</code>
</a>
</li>
<li>
<a href="analyze_metacells.html#Metacells.AnalyzeMetacells.compute_metacells_genes_log_linear_fractions!">
<code>Metacells.AnalyzeMetacells.compute_metacells_genes_log_linear_fractions!
</code>
</a>
</li>
<li>
<a href="analyze_metacells.html#Metacells.AnalyzeMetacells.compute_metacells_max_skeleton_fold_distances!">
<code>Metacells.AnalyzeMetacells.compute_metacells_max_skeleton_fold_distances!
</code>
</a>
</li>
<li>
<a href="analyze_metacells.html#Metacells.AnalyzeMetacells.compute_metacells_n_cells!">
<code>Metacells.AnalyzeMetacells.compute_metacells_n_cells!
</code>
</a>
</li>
<li>
<a href="analyze_metacells.html#Metacells.AnalyzeMetacells.compute_metacells_total_UMIs!">
<code>Metacells.AnalyzeMetacells.compute_metacells_total_UMIs!
</code>
</a>
</li>
<li>
<a href="analyze_metacells.html#Metacells.AnalyzeMetacells.compute_metacells_types_by_cells!">
<code>Metacells.AnalyzeMetacells.compute_metacells_types_by_cells!
</code>
</a>
</li>
</ul>
</article>
<nav class="docs-footer">
<a class="docs-footer-prevpage" href="analyze_cells.html">« Analyze Cells
</a>
<a class="docs-footer-nextpage" href="compute_blocks.html">Compute Blocks »
</a>
<div class="flexbox-break">
</div>
<p class="footer-message">Powered by 
<a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl
</a> and the 
<a href="https://julialang.org/">Julia Programming Language
</a>.
</p>
</nav>
</div>
<div class="modal" id="documenter-settings">
<div class="modal-background">
</div>
<div class="modal-card">
<header class="modal-card-head">
<p class="modal-card-title">Settings
</p>
<button class="delete">
</button>
</header>
<section class="modal-card-body">
<p>
<label class="label">Theme
</label>
<div class="select">
<select id="documenter-themepicker">
<option value="auto">Automatic (OS)
</option>
<option value="documenter-light">documenter-light
</option>
<option value="documenter-dark">documenter-dark
</option>
<option value="catppuccin-latte">catppuccin-latte
</option>
<option value="catppuccin-frappe">catppuccin-frappe
</option>
<option value="catppuccin-macchiato">catppuccin-macchiato
</option>
<option value="catppuccin-mocha">catppuccin-mocha
</option>
</select>
</div>
</p>
<hr/>
<p>This document was generated with 
<a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl
</a> version 1.12.0. Using Julia version 1.11.5.
</p>
</section>
<footer class="modal-card-foot">
</footer>
</div>
</div>
</div>
</body>
</html>
